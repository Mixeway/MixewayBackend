language: java
services: docker
addons:
  sonarcloud:
    organization: "mixeway" # the key of the org you chose at step #3
    token:  ${SONAR_TOKEN}


script:
  - export VERSION=1.0.0
  - mvn clean org.jacoco:jacoco-maven-plugin:prepare-agent install sonar:sonar -Dmaven.test.skip=true -Dsonar.projectKey=Mixeway_MixewayBackend -Dsonar.login=${SONAR_TOKEN}
  - docker build -t mixeway/backend:$VERSION .
  - if [[ $TRAVIS_BRANCH == 'master' ]]; then echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin; fi
  - if [[ $TRAVIS_BRANCH == 'master' ]]; then docker push mixeway/backend:$VERSION; fi