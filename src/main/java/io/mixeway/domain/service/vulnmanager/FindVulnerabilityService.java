package io.mixeway.domain.service.vulnmanager;

import io.mixeway.db.entity.Project;
import io.mixeway.db.entity.Vulnerability;
import io.mixeway.db.projection.CommonVulns;
import io.mixeway.db.projection.VulnerableProjects;
import io.mixeway.db.repository.ProjectVulnerabilityRepository;
import io.mixeway.db.repository.VulnerabilityRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;

import java.util.HashMap;

@Service
@RequiredArgsConstructor
public class FindVulnerabilityService {
    private final VulnerabilityRepository vulnerabilityRepository;
    private final ProjectVulnerabilityRepository projectVulnerabilityRepository;

    public Vulnerability findById(Long id){
        return vulnerabilityRepository.findById(id).orElse(null);
    }

    public HashMap<Vulnerability, Long> findTop10Vulns(){
        HashMap<Vulnerability, Long> vulns = new HashMap<>();
        for (CommonVulns commonVulns : projectVulnerabilityRepository.top10Vulnerabilities()) {
            vulns.put(findById(commonVulns.getId()), commonVulns.getCount());
        }
        return vulns;
    }
}
